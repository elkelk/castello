
var Constants,Tile,TileTypes;(function(){})();Constants={features:{field:"field",road:"road",city:"city",cloister:"cloister",stop:"stop"}};TileTypes={};TileTypes.get=function(features){return _.map(features,function(feature){return Constants.features[feature];});};TileTypes.starter=TileTypes.get(["stop","city","stop","road","field","field","field","road","road"]);TileTypes.diagonal_city=TileTypes.get(["stop","city","city","city","stop","field","field","field","stop"]);TileTypes.straight_city=TileTypes.get(["stop","city","stop","field","stop","city","stop","field","city"]);TileTypes.half_city=TileTypes.get(["stop","city","stop","field","field","field","field","field","field"]);TileTypes.double_half_city=TileTypes.get(["stop","city","stop","field","stop","city","stop","field","field"]);TileTypes.three_sided_city=TileTypes.get(["city","city","city","city","stop","field","stop","city","city"]);TileTypes.elbow_road=TileTypes.get(["field","road","field","road","field","field","field","field","road"]);TileTypes.straight_road=TileTypes.get(["field","road","field","field","field","road","field","field","road"]);TileTypes.t_road=TileTypes.get(["field","road","field","road","field","road","field","field","stop"]);TileTypes.t_road_ctiy=TileTypes.get(["stop","road","field","road","field","road","stop","city","stop"]);Tile=Backbone.Model.extend({defaults:{features:TileTypes.starter,position_x:0,position_y:0,placed:false},initialize:function(){},place:function(x,y){return this.set({position_x:x,position_y:y});},place_player:function(color,index){return this.set({player_on:index,player_color:color});},feature:function(index){return this.get("features")[index];},feature_continues:function(index,direction){var adjacent_city,adjacent_field,center_same,feature,feature_continues,neighboring_field,opposite,opposite_neighboring_field;if(direction==null){direction=null;}
feature_continues=false;feature=this.feature(index);if(this.feature_is_side(index)){opposite=this.opposite_feature(index);center_same=feature===this.center_feature();feature_continues=center_same&&feature===opposite;feature_continues||(feature_continues=_.include(this.neighboring_features(index),feature));feature_continues||(feature_continues=_.include(this.adjacent_features(index),feature)&&center_same);if(feature===Constants.features.road){neighboring_field=this.neighboring_feature(index,direction)===Constants.features.field;adjacent_field=this.adjacent_feature(direction)===Constants.features.field;opposite_neighboring_field=this.neighboring_feature(this.opposite_feature_index(index),direction)===Constants.features.field;feature_continues||(feature_continues=neighboring_field&&adjacent_field&&opposite_neighboring_field);adjacent_city=this.adjacent_feature(direction)===Constants.features.city;feature_continues||(feature_continues=adjacent_city&&opposite!==Constants.features.city);}}
return feature_continues;},feature_is_side:function(index){return _.include([1,3,5,7],index);},feature_is_corner:function(index){return _.include([0,2,4,6],index);},center_feature:function(){return this.feature(8);},neighboring_features:function(index){return this._get_surrounding_features(index,1);},neighboring_feature:function(index,direction){var location;location=(function(){switch(direction){case"north":if(index===3){return 2;}else{return 0;}
break;case"east":if(index===1){return 2;}else{return 4;}
break;case"south":if(index===3){return 4;}else{return 6;}
break;case"west":if(index===1){return 0;}else{return 6;}}})();return this.feature(location);},adjacent_features:function(index){return this._get_surrounding_features(index,2);},adjacent_feature:function(direction){var location;location=(function(){switch(direction){case"north":return location=1;case"east":return location=3;case"south":return location=5;case"west":return location=7;}})();return this.feature(location);},opposite_feature:function(index){return this.feature(this.opposite_feature_index(index));},opposite_feature_index:function(index){return this._normalize_feature_index(index+4);},_get_surrounding_features:function(index,distance){var left_index,right_index;left_index=this._normalize_feature_index(index-distance);right_index=this._normalize_feature_index(index+distance);return[this.feature(left_index),this.feature(right_index)];},_normalize_feature_index:function(index){if(index>7){index=index-8;}
if(index<0){index=8+index;}
return index;}});